#!/bin/bash

echo "ðŸš€ å¯åŠ¨ä»“å‚¨ç®¡ç†ç³»ç»Ÿï¼ˆä¾›åº”å•†ç®¡ç†åŠŸèƒ½å±•ç¤ºï¼‰"

# æ£€æŸ¥åŽç«¯æ˜¯å¦åœ¨è¿è¡Œ
if lsof -Pi :3001 -sTCP:LISTEN -t >/dev/null ; then
    echo "âœ… åŽç«¯æœåŠ¡å·²åœ¨è¿è¡Œ (ç«¯å£3001)"
else
    echo "ðŸ”„ å¯åŠ¨åŽç«¯æœåŠ¡..."
    cd backend
    node dist/index.js &
    BACKEND_PID=$!
    echo "âœ… åŽç«¯æœåŠ¡å·²å¯åŠ¨ PID: $BACKEND_PID"
    cd ..
fi

# æ£€æŸ¥å‰ç«¯æ˜¯å¦åœ¨è¿è¡Œ
if lsof -Pi :5173 -sTCP:LISTEN -t >/dev/null ; then
    echo "âœ… å‰ç«¯æœåŠ¡å·²åœ¨è¿è¡Œ (ç«¯å£5173)"
else
    echo "ðŸ”„ å¯åŠ¨å‰ç«¯æœåŠ¡..."
    cd frontend
    npm run dev &
    FRONTEND_PID=$!
    echo "âœ… å‰ç«¯æœåŠ¡å·²å¯åŠ¨ PID: $FRONTEND_PID"
    cd ..
fi

echo ""
echo "ðŸŽ‰ ç³»ç»Ÿå¯åŠ¨å®Œæˆï¼"
echo ""
echo "ðŸ“± å‰ç«¯åœ°å€: http://localhost:5173"
echo "ðŸ”§ åŽç«¯åœ°å€: http://localhost:3001"
echo "ðŸ‘¤ ç™»å½•è´¦æˆ·: admin / 123456"
echo ""
echo "âœ¨ ä¾›åº”å•†ç®¡ç†åŠŸèƒ½ç‰¹è‰²ï¼š"
echo "   ðŸª ä¾›åº”å•†æ¡£æ¡ˆå®Œæ•´CRUDç®¡ç†"
echo "   ðŸ·ï¸ ä¾›åº”å•†ç±»åž‹åˆ†ç±»ï¼ˆç”Ÿäº§å•†/åˆ†é”€å•†/é›¶å”®å•†/æœåŠ¡å•†ï¼‰"
echo "   ðŸ“ž è”ç³»ä¿¡æ¯ç®¡ç†ï¼ˆè”ç³»äººã€ç”µè¯ã€é‚®ç®±ã€åœ°å€ï¼‰"
echo "   ðŸ¦ é“¶è¡Œè´¦æˆ·å’Œç¨Žå·ç®¡ç†"
echo "   ðŸ’³ ä»˜æ¬¾æ¡ä»¶é…ç½®"
echo "   ðŸ”„ ä¾›åº”å•†çŠ¶æ€ç®¡ç†ï¼ˆåˆä½œä¸­/åœç”¨/å¾…å®¡æ ¸/æš‚åœï¼‰"
echo "   ðŸ” å¤šæ¡ä»¶æœç´¢ä¸Žç­›é€‰åŠŸèƒ½"
echo ""
echo "ðŸŽ¯ ä½¿ç”¨æŒ‡å—ï¼š"
echo "   1. ç‚¹å‡»å·¦ä¾§å¯¼èˆª'ä¾›åº”å•†ç®¡ç†'"
echo "   2. ç‚¹å‡»'æ–°å¢žä¾›åº”å•†'åˆ›å»ºä¾›åº”å•†æ¡£æ¡ˆ"
echo "   3. ä½¿ç”¨æœç´¢åŠŸèƒ½å¿«é€ŸæŸ¥æ‰¾ä¾›åº”å•†"
echo "   4. ç¼–è¾‘ä¾›åº”å•†ä¿¡æ¯æ›´æ–°æ¡£æ¡ˆ"
echo "   5. æŸ¥çœ‹ä¾›åº”å•†çŠ¶æ€å’Œåˆ†ç±»ç»Ÿè®¡"
echo ""
echo "ðŸ”— ä¸Žå…¶ä»–æ¨¡å—è”åŠ¨ï¼š"
echo "   - é‡‡è´­è®¢å•å¯å…³è”ä¾›åº”å•†ä¿¡æ¯"
echo "   - è´§å“ç®¡ç†å¯è®¾ç½®é»˜è®¤ä¾›åº”å•†"
echo "   - æˆæœ¬è®¡ç®—åŸºäºŽä¾›åº”å•†ä»·æ ¼"
echo ""
echo "æŒ‰ Ctrl+C åœæ­¢æœåŠ¡"

# ç­‰å¾…ç”¨æˆ·ä¸­æ–­
trap 'echo ""; echo "ðŸ›‘ æ­£åœ¨åœæ­¢æœåŠ¡..."; kill $BACKEND_PID $FRONTEND_PID 2>/dev/null; exit' INT
wait 